<div class="container mx-auto p-4 max-w-3xl">
  <div *ngIf="!showForm" class="text-center">
    <h2 class="text-2xl font-bold mb-4">Welcome to the Form Builder</h2>
    <p class="mb-4">Click the button below to start creating your form.</p>
    <button
      (click)="startForm()"
      class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
    >
      Let's Get Started
    </button>
  </div>

  <div *ngIf="showForm" class="space-y-6">
    <h2 class="text-2xl font-bold mb-4">Form Builder</h2>

    <div *ngIf="!currentSection" class="text-center">
      <button
        (click)="addSection()"
        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
      >
        Add Section
      </button>
    </div>

    <div
      *ngIf="currentSection && !currentSection.title"
      class="bg-white p-4 rounded"
    >
      <h3 class="text-xl font-semibold mb-2">Add Section Title</h3>
      <form [formGroup]="builderForm" class="space-y-2">
        <input
          formControlName="sectionTitle"
          placeholder="Section Title"
          class="w-full p-2 border rounded"
        />
        <button
          (click)="saveSectionTitle()"
          class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
        >
          Save Section Title
        </button>
      </form>
    </div>

    <div
      *ngIf="currentSection && currentSection.title"
      class="bg-white p-4 rounded"
    >
      <h3 class="text-xl font-semibold mb-2">
        Section Title: {{ currentSection.title }}
      </h3>
    </div>

    <!-- Wrap the entire form in a formGroup -->
    <form [formGroup]="builderForm" class="space-y-6">
      <div
        *ngIf="currentRow && !currentAdapter && !showFieldAddedPrompt"
        class="bg-white p-4 rounded"
      >
        <app-adapter-selector
          [parentForm]="builderForm"
          (buttonAction)="addAdapter($event)"
        ></app-adapter-selector>
      </div>

      <div *ngIf="currentRow && currentAdapter" class="bg-white p-4 rounded">
        <h3 class="text-xl font-semibold mb-2">
          Element Type: {{ currentAdapter }}
        </h3>
        <button
          (click)="changeAdapter()"
          class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
        >
          Change Element
        </button>
      </div>

      <div *ngIf="currentRow && currentAdapter" class="bg-white p-4 rounded">
        <h4 class="text-lg font-semibold mb-2">Add Field</h4>
        <div class="space-y-2">
          <select formControlName="fieldType" class="w-full p-2 border rounded">
            <option value="text">Text</option>
            <option value="email">Email</option>
            <option value="number">Number</option>
            <option value="tel">Tel</option>
            <option value="textarea">Textarea</option>
            <option value="date">Date</option>
            <option value="password">Password</option>
            <option value="url">URL</option>
          </select>
          <input
            formControlName="fieldLabel"
            placeholder="Label"
            class="w-full p-2 border rounded"
          />
          <input
            formControlName="fieldControlName"
            placeholder="Control Name"
            class="w-full p-2 border rounded"
          />
          <label class="flex items-center space-x-2">
            <input
              type="checkbox"
              formControlName="fieldRequired"
              class="form-checkbox"
            />
            <span>Required</span>
          </label>
          <input
            formControlName="fieldPlaceholder"
            placeholder="Placeholder"
            class="w-full p-2 border rounded"
          />
          <input
            formControlName="fieldErrorMessage"
            placeholder="Error Message"
            class="w-full p-2 border rounded"
          />
          <input
            formControlName="fieldInitialValue"
            placeholder="Initial Value"
            class="w-full p-2 border rounded"
          />
          <button
            *ngIf="!showFieldAddedPrompt"
            (click)="addField()"
            class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
          >
            Add Field
          </button>
        </div>
      </div>

      <!-- Add this new section after adding a field -->
      <div *ngIf="showFieldAddedPrompt" class="mt-4 p-4 bg-yellow-100 rounded">
        <p class="font-semibold mb-2">
          Field added successfully! What would you like to do next?
        </p>
        <div class="flex space-x-2">
          <button
            (click)="addAnotherField()"
            class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
          >
            Add Another Field
          </button>
          <button
            (click)="addNewRow()"
            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded"
          >
            Add New Row
          </button>
          <button
            (click)="addNewSection()"
            class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded"
          >
            Add New Section
          </button>
        </div>
      </div>

      <div *ngIf="currentSection">
        <button
          (click)="saveForm()"
          class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded"
        >
          Save Form
        </button>
        <button
          (click)="viewForm()"
          class="ml-4 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded"
        >
          View Form
        </button>
      </div>
    </form>
  </div>
</div>
